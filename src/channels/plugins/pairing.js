import { getChannelPlugin, listChannelPlugins, normalizeChannelId } from "./index.js";
export function listPairingChannels() {
  return listChannelPlugins().filter((plugin) => plugin.pairing).map((plugin) => plugin.id);
}

export function getPairingAdapter(channelId) {
  const plugin = getChannelPlugin(channelId);
  return (plugin?.pairing ?? null);
}

export function requirePairingAdapter(channelId) {
  const adapter = getPairingAdapter(channelId);
  if (!adapter) {
    throw new Error("Channel  does not support pairing");
  }
  return adapter;
}

export function resolvePairingChannel(raw) {
  const value = (typeof raw === "string") ? raw : ((typeof raw === "number") || (typeof raw === "boolean")) ? String(raw) : "".trim().toLowerCase();
  const normalized = normalizeChannelId(value);
  const channels = listPairingChannels();
  if ((!normalized || !channels.includes(normalized))) {
    throw new Error("Invalid channel:  (expected one of: )");
  }
  return normalized;
}

export async function notifyPairingApproved(params) {
  const adapter = (params.pairingAdapter ?? requirePairingAdapter(params.channelId));
  if (!adapter.notifyApproval) {
    return;
  }
  await adapter.notifyApproval({ cfg: params.cfg, id: params.id, runtime: params.runtime });
}

